<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>VR-Infotainment √ñffnungszeiten</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f5f5;
        padding: 2rem 1rem;
      }
      .calendar-widget {
        max-width: 1200px;
        margin: 0 auto;
        background: #fff;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        border: 2px solid #e0e0e0;
        transition: all 0.3s;
      }
      .calendar-widget:hover {
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        border-color: #2563eb;
      }
      .calendar-body {
        padding: 3rem;
      }
      .month-navigation {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 3rem;
      }
      .nav-button {
        background: #000;
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        cursor: pointer;
        font-size: 1.5rem;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .nav-button:hover {
        background: #333;
        transform: scale(1.1);
      }
      .nav-button:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }
      .month-year {
        font-size: 2rem;
        font-weight: 700;
        color: #000;
      }
      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1rem;
      }
      .day-header {
        text-align: center;
        font-weight: 700;
        padding: 1.5rem 0.5rem;
        color: #000;
        font-size: 1.1rem;
        border-bottom: 3px solid #e0e0e0;
        margin-bottom: 1rem;
      }
      .calendar-day {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 15px;
        font-weight: 600;
        font-size: 1.2rem;
        transition: all 0.3s;
        position: relative;
        border: 2px solid transparent;
        min-height: 80px;
        flex-direction: column;
        gap: 0.2rem;
        padding: 0.6rem;
        text-decoration: none;
      }
      .calendar-day.other-month {
        color: #ddd;
        background: #fafafa;
      }
      .calendar-day.current-month {
        color: #999;
        background: #f5f5f5;
      }
      .calendar-day.open {
        background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
        color: #fff;
        box-shadow: 0 4px 15px rgba(37, 99, 235, 0.25);
        cursor: pointer;
        text-decoration: none;
      }
      .calendar-day.open:hover {
        background: linear-gradient(135deg, #1d4ed8 0%, #1e3a8a 100%);
        transform: scale(1.08);
        box-shadow: 0 6px 25px rgba(37, 99, 235, 0.35);
      }
      .calendar-day.open.past {
        background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
        cursor: not-allowed;
        opacity: 0.6;
        pointer-events: none;
      }
      .calendar-day.open.past:hover {
        transform: none;
        box-shadow: 0 4px 15px rgba(156, 163, 175, 0.25);
      }
      .calendar-day.open.sold-out {
        background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        cursor: default;
      }
      .calendar-day.open.sold-out:hover {
        transform: none;
        box-shadow: 0 4px 15px rgba(75, 85, 99, 0.25);
      }
      .day-number {
        font-size: 1.5rem;
        font-weight: 700;
      }
      .day-label {
        font-size: 0.7rem;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .kw-label {
        font-size: 0.6rem;
        opacity: 0.8;
        margin-top: 0.1rem;
      }
      .calendar-day.today {
        border-color: #2563eb;
        border-width: 3px;
      }
      .calendar-day.today.open {
        border-color: #fff;
        box-shadow: 0 0 0 3px #2563eb, 0 4px 15px rgba(37, 99, 235, 0.25);
      }
      .calendar-day.today.open.past {
        box-shadow: 0 0 0 3px #9ca3af, 0 4px 15px rgba(156, 163, 175, 0.25);
      }
      .ticket-availability {
        font-size: 0.75rem;
        padding: 0.2rem 0.6rem;
        border-radius: 999px;
        background: rgba(243, 244, 246, 0.9);
        color: #111827;
        text-align: center;
        line-height: 1.3;
        max-width: 100%;
        word-wrap: break-word;
        word-break: break-word;
      }
      .calendar-day.open .ticket-availability {
        background: rgba(255, 255, 255, 0.18);
        color: #fff;
      }
      .calendar-day.open.past .ticket-availability {
        background: rgba(229, 231, 235, 0.4);
        color: #f3f4f6;
      }
      .ticket-availability[data-status="loading"] {
        opacity: 0.8;
      }
      .ticket-availability[data-status="available"] {
        background: rgba(16, 185, 129, 0.18);
        color: #047857;
      }
      .calendar-day.open .ticket-availability[data-status="available"] {
        background: rgba(16, 185, 129, 0.25);
        color: #ecfdf5;
      }
      .ticket-availability[data-status="sold-out"],
      .ticket-availability[data-status="waitlist"] {
        background: rgba(254, 202, 202, 0.6);
        color: #b91c1c;
      }
      .calendar-day.open .ticket-availability[data-status="sold-out"],
      .calendar-day.open .ticket-availability[data-status="waitlist"] {
        background: rgba(248, 113, 113, 0.25);
        color: #fee2e2;
      }
      .ticket-availability[data-status="error"],
      .ticket-availability[data-status="unknown"] {
        background: rgba(209, 213, 219, 0.6);
        color: #374151;
      }
      .ticket-availability[data-status="past"] {
        background: rgba(156, 163, 175, 0.4);
        color: #374151;
      }
      .calendar-day.open .ticket-availability[data-status="past"] {
        background: rgba(229, 231, 235, 0.25);
        color: #f3f4f6;
      }
      .legend {
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 2px solid #e0e0e0;
        display: flex;
        justify-content: center;
        gap: 4rem;
        flex-wrap: wrap;
      }
      .legend-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        font-size: 1.1rem;
        color: #666;
      }
      .legend-color {
        width: 24px;
        height: 24px;
        border-radius: 6px;
        border: 2px solid #ddd;
      }
      .legend-color.open {
        background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
        border-color: #2563eb;
      }
      .legend-color.past {
        background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
        border-color: #9ca3af;
        opacity: 0.6;
      }
      .legend-color.closed {
        background: #f5f5f5;
        border-color: #e0e0e0;
      }
      .legend-color.sold-out {
        background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        border-color: #4b5563;
      }
      .info-text {
        text-align: center;
        color: #666;
        font-size: 1rem;
        margin-top: 2rem;
        padding: 1.5rem;
        background: #f8f8f8;
        border-radius: 10px;
      }
      @media (max-width: 1024px) {
        .calendar-widget {
          max-width: 90%;
        }
        .calendar-body {
          padding: 2rem;
        }
        .month-year {
          font-size: 1.5rem;
        }
        .calendar-day {
          min-height: 70px;
          font-size: 1rem;
        }
        .day-number {
          font-size: 1.3rem;
        }
      }
      @media (max-width: 768px) {
        body {
          padding: 0.5rem;
        }
        .calendar-widget {
          max-width: 100%;
          border-radius: 15px;
        }
        .calendar-body {
          padding: 1.5rem 1rem;
        }
        .month-navigation {
          margin-bottom: 2rem;
        }
        .nav-button {
          width: 45px;
          height: 45px;
        }
        .month-year {
          font-size: 1.2rem;
        }
        .calendar-grid {
          gap: 0.4rem;
        }
        .calendar-day {
          min-height: 50px;
          font-size: 0.9rem;
          border-radius: 10px;
        }
        .day-number {
          font-size: 1.1rem;
        }
        .day-label {
          font-size: 0.6rem;
        }
        .kw-label {
          display: none;
        }
        .day-header {
          font-size: 0.8rem;
          padding: 0.8rem 0.2rem;
        }
        .legend {
          gap: 1.5rem;
          flex-direction: column;
          align-items: center;
        }
        .legend-item {
          font-size: 0.9rem;
        }
        .info-text {
          font-size: 0.9rem;
          padding: 1rem;
        }
      }
      @media (max-width: 480px) {
        .calendar-body {
          padding: 1rem 0.5rem;
        }
        .nav-button {
          width: 40px;
          height: 40px;
          font-size: 1.2rem;
        }
        .month-year {
          font-size: 1rem;
        }
        .calendar-grid {
          gap: 0.2rem;
        }
        .calendar-day {
          min-height: 40px;
          font-size: 0.8rem;
          border-radius: 8px;
        }
        .day-number {
          font-size: 0.9rem;
        }
        .day-label {
          display: none;
        }
        .day-header {
          font-size: 0.7rem;
          padding: 0.5rem 0.1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="calendar-widget">
      <div class="calendar-body">
        <div class="month-navigation">
          <button class="nav-button" onclick="previousMonth()" id="prevBtn">‚Äπ</button>
          <div class="month-year" id="monthYear">August 2025</div>
          <button class="nav-button" onclick="nextMonth()" id="nextBtn">‚Ä∫</button>
        </div>
        <div class="calendar-grid" id="calendarGrid">
          <div class="day-header">Mo</div>
          <div class="day-header">Di</div>
          <div class="day-header">Mi</div>
          <div class="day-header">Do</div>
          <div class="day-header">Fr</div>
          <div class="day-header">Sa</div>
          <div class="day-header">So</div>
        </div>
        <div class="legend">
          <div class="legend-item">
            <div class="legend-color open"></div>
            <span>Ge√∂ffnet - Tickets verf√ºgbar</span>
          </div>
          <div class="legend-item">
            <div class="legend-color past"></div>
            <span>Vergangen - nicht mehr buchbar</span>
          </div>
          <div class="legend-item">
            <div class="legend-color sold-out"></div>
            <span>Ausverkauft / Warteliste</span>
          </div>
          <div class="legend-item">
            <div class="legend-color closed"></div>
            <span>Geschlossen</span>
          </div>
        </div>
        <div class="info-text">
          üìç VR-Infotainment Ausstellung ‚Ä¢ Altenberger-Stra√üe 69 A, 01744 Dippoldiswalde
          <br />
          üé´ Klicken Sie auf die markierten Tage f√ºr direkte Ticketbuchung der jeweiligen
          Kalenderwoche. Die Kontingente werden live von ticket-regional.de geladen.
        </div>
      </div>
    </div>
    <script>
      // Optional: Use a CORS proxy if ticket-regional.de blocks direct requests.
      // Set to e.g. "https://cors.isomorphic-git.org/" (trailing slash required).
      const CORS_PROXY = "";
      const kwUrls = {
        34: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=prevWeek&startTime=1755511200",
        35: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1756116000",
        36: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1756720800",
        37: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1757325600",
        38: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1757930400",
        39: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1758535200",
        40: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1759140000",
        41: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1759744800",
        42: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1760349600",
        43: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1760954400",
        44: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1761559200",
        45: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1762167600",
        46: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1762772400",
        47: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1763377200",
        48: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1763982000",
        49: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1764586800",
        50: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1765191600",
        51: "https://www.ticket-regional.de/stage_2688.php?timeID=1006912&action=nextWeek&startTime=1765796400",
      };

      const holidays = {
        "2025-01-01": "Neujahr",
        "2025-04-18": "Karfreitag",
        "2025-04-21": "Ostermontag",
        "2025-05-01": "Tag der Arbeit",
        "2025-05-29": "Christi Himmelfahrt",
        "2025-06-09": "Pfingstmontag",
        "2025-10-03": "Tag der Deutschen Einheit",
        "2025-10-31": "Reformationstag",
        "2025-11-19": "Bu√ü- und Bettag",
        "2025-12-25": "1. Weihnachtsfeiertag",
        "2025-12-26": "2. Weihnachtsfeiertag",
      };

      const lastOpen = new Date(2025, 11, 21, 12, 0, 0);
      let curMonth = 8;
      let curYear = 2025;
      const months = [
        "Januar",
        "Februar",
        "M√§rz",
        "April",
        "Mai",
        "Juni",
        "Juli",
        "August",
        "September",
        "Oktober",
        "November",
        "Dezember",
      ];
      const domParser = new DOMParser();
      const weekDataCache = new Map();
      const weekPending = new Map();
      const ISOFormatter = new Intl.DateTimeFormat("sv-SE", {
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
      });

      const getWeek = (d) => {
        const t = new Date(d.getFullYear(), d.getMonth(), d.getDate());
        const n = t.getDay() || 7;
        t.setDate(t.getDate() + 4 - n);
        const y = new Date(t.getFullYear(), 0, 1);
        return Math.ceil(((t - y) / 86400000 + 1) / 7);
      };

      const isPastWeek = (d) => {
        const t = new Date();
        const cw = getWeek(t);
        const cy = t.getFullYear();
        const dw = getWeek(d);
        const dy = d.getFullYear();
        return dy < cy || (dy === cy && dw < cw);
      };

      const isOpen = (d) =>
        d <= lastOpen &&
        (d.getDay() === 0 ||
          d.getDay() === 6 ||
          holidays[d.toISOString().split("T")[0]]);

      const fmtDate = (d) => ISOFormatter.format(d);

      const createEl = (t, c, h, a) => {
        const e = document.createElement(t);
        if (c) e.className = c;
        if (h !== undefined) e.innerHTML = h;
        if (a) Object.assign(e, a);
        return e;
      };

      const escapeHtml = (str = "") =>
        str
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");

      const parseFreeInfo = (text) => {
        const normalized = text.replace(/\s+/g, " ").trim();
        const freeMatch = normalized.match(/(\d+)\s*(?:Pl[a√§]tze\s*frei|freie\s*Pl[a√§]tze|Tickets\s*(?:frei|verf[u√º]gbar)|Restkarten)/i);
        const soldOut = /ausverkauft|keine tickets|nicht verf[u√º]gbar/i.test(normalized);
        const waitlist = /warteliste/i.test(normalized);
        if (freeMatch) {
          const free = Number.parseInt(freeMatch[1], 10);
          return {
            free,
            status: free > 0 ? "available" : "sold-out",
            text: `${free} Pl√§tze frei`,
          };
        }
        if (waitlist) {
          return { free: 0, status: "waitlist", text: "Warteliste" };
        }
        if (soldOut) {
          return { free: 0, status: "sold-out", text: "Ausverkauft" };
        }
        return { free: null, status: "unknown", text: normalized };
      };

      const aggregateEntries = (entries) => {
        if (!entries.length) {
          return {
            status: "sold-out",
            html: "Ausverkauft",
          };
        }
        const seen = new Set();
        let hasTickets = false;
        let hasWaitlist = false;
        const lines = entries
          .map((entry) => {
            const parts = [];
            if (entry.time) parts.push(entry.time);
            if (entry.info) parts.push(entry.info.text);
            const text = parts.length ? parts.join(" ¬∑ ") : entry.info?.text || entry.raw;
            if (entry.info?.status === "available" || entry.info?.status === "unknown") {
              hasTickets = true;
            }
            if (entry.info?.status === "waitlist") {
              hasWaitlist = true;
            }
            const sanitized = escapeHtml(text || "");
            if (!sanitized) return null;
            if (seen.has(sanitized)) return null;
            seen.add(sanitized);
            return sanitized;
          })
          .filter(Boolean);

        return {
          status: hasTickets ? "available" : hasWaitlist ? "waitlist" : "sold-out",
          html: lines.length
            ? lines.join("<br>")
            : hasWaitlist
            ? "Warteliste"
            : "Keine Tickets",
        };
      };

      const parseWeekHtml = (html) => {
        const doc = domParser.parseFromString(html, "text/html");
        const result = {};
        const addEntry = (iso, entry) => {
          if (!iso) return;
          if (!result[iso]) result[iso] = [];
          result[iso].push(entry);
        };

        const grabTime = (text) => {
          const match = text.match(/(\d{1,2}:\d{2})/);
          return match ? match[1] : null;
        };

        doc.querySelectorAll("[data-date]").forEach((el) => {
          const iso = el.getAttribute("data-date");
          const time = el.getAttribute("data-time") || grabTime(el.textContent);
          const freeAttr = el.getAttribute("data-free");
          const info =
            freeAttr !== null
              ? {
                  free: Number.parseInt(freeAttr, 10),
                  status:
                    Number.parseInt(freeAttr, 10) > 0 ? "available" : "sold-out",
                  text:
                    Number.parseInt(freeAttr, 10) > 0
                      ? `${freeAttr} Pl√§tze frei`
                      : "Ausverkauft",
                }
              : parseFreeInfo(el.textContent);
          addEntry(iso, { time, info, raw: el.textContent.trim() });
        });

        doc.querySelectorAll("table tr").forEach((row) => {
          const text = row.textContent.replace(/\s+/g, " ").trim();
          const dateMatch = text.match(/(\d{2})\.(\d{2})\.(\d{4})/);
          if (!dateMatch) return;
          const iso = `${dateMatch[3]}-${dateMatch[2]}-${dateMatch[1]}`;
          const time = grabTime(text);
          const info = parseFreeInfo(text);
          addEntry(iso, { time, info, raw: text });
        });

        doc.querySelectorAll("p, li, div, span").forEach((node) => {
          const text = node.textContent.replace(/\s+/g, " ").trim();
          const dateMatch = text.match(/(\d{2})\.(\d{2})\.(\d{4})/);
          if (!dateMatch) return;
          const iso = `${dateMatch[3]}-${dateMatch[2]}-${dateMatch[1]}`;
          const time = grabTime(text);
          const info = parseFreeInfo(text);
          addEntry(iso, { time, info, raw: text });
        });

        const aggregated = {};
        Object.entries(result).forEach(([iso, entries]) => {
          aggregated[iso] = aggregateEntries(entries);
        });
        return aggregated;
      };

      const requestWeekData = (kw) => {
        if (!kwUrls[kw]) return Promise.resolve(null);
        if (weekDataCache.has(kw)) {
          return Promise.resolve(weekDataCache.get(kw));
        }
        if (weekPending.has(kw)) {
          return weekPending.get(kw);
        }
        const url = kwUrls[kw];
        const fetchUrl = CORS_PROXY ? `${CORS_PROXY}${url}` : url;
        const request = fetch(fetchUrl, { mode: "cors" })
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP ${response.status}`);
            }
            return response.text();
          })
          .then((html) => {
            const data = parseWeekHtml(html);
            weekDataCache.set(kw, data);
            return data;
          })
          .catch((error) => {
            console.error("Fehler beim Laden der Ticketdaten", error);
            weekDataCache.set(kw, null);
            return null;
          })
          .finally(() => {
            weekPending.delete(kw);
          });
        weekPending.set(kw, request);
        return request;
      };

      const updateAvailability = (date, kw, labelEl, dayEl) => {
        const iso = fmtDate(date);
        labelEl.dataset.status = "loading";
        labelEl.textContent = "Kontingent wird geladen‚Ä¶";
        requestWeekData(kw).then((data) => {
          if (!document.body.contains(dayEl)) return;
          if (!data) {
            labelEl.dataset.status = "error";
            labelEl.textContent = "Kontingent nicht verf√ºgbar";
            return;
          }
          const dayInfo = data[iso];
          if (!dayInfo) {
            labelEl.dataset.status = "sold-out";
            labelEl.textContent = "Keine Tickets";
            dayEl.classList.add("sold-out");
            return;
          }
          labelEl.dataset.status = dayInfo.status;
          labelEl.innerHTML = dayInfo.html;
          if (dayInfo.status === "sold-out" || dayInfo.status === "waitlist") {
            dayEl.classList.add("sold-out");
          } else {
            dayEl.classList.remove("sold-out");
          }
        });
      };

      const createDay = (day, mClass, date) => {
        const open = mClass === "current-month" && date && isOpen(date);
        const past = date && isPastWeek(date);
        const today = date && fmtDate(date) === fmtDate(new Date());
        const kw = date && getWeek(date);
        const url = kw && kwUrls[kw];
        const holiday = date && holidays[fmtDate(date)];
        const dayType =
          date &&
          (holiday
            ? "Feiertag"
            : date.getDay() === 0
            ? "Sonntag"
            : date.getDay() === 6
            ? "Samstag"
            : "");

        let el;
        const content = `
          <span class="day-number">${day}</span>
          ${dayType ? `<span class="day-label">${dayType}${holiday ? ` ¬∑ ${holiday}` : ""}</span>` : ""}
          <span class="kw-label">KW ${kw ?? ""}</span>
        `;

        if (open && url && !past) {
          el = createEl(
            "a",
            `calendar-day ${mClass} open${today ? " today" : ""}`,
            content,
            {
              href: url,
              target: "_blank",
              rel: "noopener noreferrer",
              title: `Tickets f√ºr KW ${kw} buchen (${day}. ${months[date.getMonth()]}${holiday ? " - " + holiday : ""})`,
            }
          );
        } else if (open) {
          el = createEl(
            "div",
            `calendar-day ${mClass} open${past ? " past" : ""}${today ? " today" : ""}`,
            content
          );
          el.title = past
            ? `KW ${kw} - Vergangen (nicht mehr buchbar)`
            : "Tickets noch nicht verf√ºgbar";
        } else {
          el = createEl(
            "div",
            `calendar-day ${mClass}${today ? " today" : ""}`,
            `<span class="day-number">${day}</span>`
          );
          if (mClass === "current-month") el.title = "Geschlossen";
        }

        if (open) {
          const availability = createEl("span", "ticket-availability", "");
          el.appendChild(availability);
          if (kw && !past) {
            updateAvailability(date, kw, availability, el);
          } else if (kw) {
            availability.dataset.status = "past";
            availability.textContent = "Vergangene Woche";
          }
        }

        return el;
      };

      const genCal = (y, m) => {
        const g = document.getElementById("calendarGrid");
        document.getElementById("monthYear").textContent = `${months[m - 1]} ${y}`;
        g.querySelectorAll(".calendar-day").forEach((d) => d.remove());
        const first = new Date(y, m - 1, 1);
        const last = new Date(y, m, 0);
        const days = last.getDate();
        const start = (first.getDay() + 6) % 7;
        const pM = m === 1 ? 12 : m - 1;
        const pY = m === 1 ? y - 1 : y;
        const pDays = new Date(pY, pM, 0).getDate();

        for (let i = start - 1; i >= 0; i--) {
          g.appendChild(
            createDay(pDays - i, "other-month", new Date(pY, pM - 1, pDays - i, 12, 0, 0))
          );
        }
        for (let d = 1; d <= days; d++) {
          g.appendChild(createDay(d, "current-month", new Date(y, m - 1, d, 12, 0, 0)));
        }
        const cells = Math.ceil((start + days) / 7) * 7 - (start + days);
        const nM = m === 12 ? 1 : m + 1;
        const nY = m === 12 ? y + 1 : y;
        for (let d = 1; d <= cells; d++) {
          g.appendChild(createDay(d, "other-month", new Date(nY, nM - 1, d, 12, 0, 0)));
        }
        document.getElementById("prevBtn").disabled = m <= 1;
        document.getElementById("nextBtn").disabled = m >= 12;
      };

      const previousMonth = () => {
        if (curMonth > 1) {
          curMonth--;
          genCal(curYear, curMonth);
        }
      };
      const nextMonth = () => {
        if (curMonth < 12) {
          curMonth++;
          genCal(curYear, curMonth);
        }
      };

      document.addEventListener("DOMContentLoaded", () => {
        const t = new Date();
        if (t.getFullYear() === 2025) {
          const m = t.getMonth() + 1;
          if (m >= 1 && m <= 12) curMonth = m;
        }
        genCal(curYear, curMonth);
      });

      window.previousMonth = previousMonth;
      window.nextMonth = nextMonth;
    </script>
  </body>
</html>
